<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scan-to-Call</title>
  <meta name="description" content="Scan a QR code to instantly call the embedded phone number." />
  <style>
    body { margin:0; font-family: system-ui, Arial, sans-serif; background:#0b1220; color:#e5e7eb; }
    header { text-align:center; padding: 16px; }
    h1 { margin:0; font-size: 28px; }
    .wrap { max-width: 880px; margin: 0 auto; padding: 24px; }
    .card { background:#111827; border-radius:14px; padding:16px; box-shadow:0 8px 20px rgba(0,0,0,0.3); margin-bottom:20px; }
    .btn { background:#2563eb; color:white; border:0; padding:12px 16px; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .muted { color:#9ca3af; font-size:14px; }
    #reader { width:100%; }
    #callLink { display:none; margin-top:10px; }
    pre { background:#0b1220; border:1px solid #374151; padding:12px; border-radius:10px; min-height:50px; }
  </style>
  <!-- QR scanning library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.10/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <header>
    <h1>ðŸ“ž Scan-to-Call</h1>
    <p class="muted">Point your camera at a QR code containing a phone number.</p>
  </header>
  <div class="wrap">
    <div class="card">
      <div id="reader"></div>
      <p id="status" class="muted">Waiting for camera accessâ€¦</p>
      <button id="startBtn" class="btn">Start Scanner</button>
      <button id="stopBtn" class="btn" disabled>Stop</button>
    </div>

    <div class="card">
      <h2>Result</h2>
      <pre id="raw"></pre>
      <a id="callLink" class="btn" href="#">ðŸ“² Call this number</a>
      <p id="parsed" class="muted"></p>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const rawEl = document.getElementById('raw');
    const parsedEl = document.getElementById('parsed');
    const callLink = document.getElementById('callLink');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');

    function extractPhone(text) {
      if (!text) return null;
      let s = text.trim();
      if (s.toLowerCase().startsWith("tel:")) s = s.slice(4);
      s = s.replace(/[^+0-9]/g, '');
      if (s.length < 7) return null;
      if (!s.startsWith('+') && s.length >= 10) s = '+' + s;
      return s;
    }

    function updateUI(scanned, phone) {
      rawEl.textContent = scanned || '';
      if (phone) {
        parsedEl.textContent = "Detected phone: " + phone;
        callLink.href = "tel:" + phone;
        callLink.style.display = "inline-block";
      } else {
        parsedEl.textContent = "No valid phone detected yet.";
        callLink.style.display = "none";
      }
    }

    let html5Qrcode;
    let isRunning = false;

    async function startScanner() {
      if (!html5Qrcode) {
        html5Qrcode = new Html5Qrcode('reader');
      }
      try {
        await html5Qrcode.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: { width: 250, height: 250 } },
          (decodedText) => {
            const phone = extractPhone(decodedText);
            updateUI(decodedText, phone);
          }
        );
        statusEl.textContent = "Scanningâ€¦";
        isRunning = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
      } catch (err) {
        statusEl.textContent = "Camera error: " + err;
      }
    }

    async function stopScanner() {
      if (html5Qrcode && isRunning) {
        await html5Qrcode.stop();
        await html5Qrcode.clear();
        statusEl.textContent = "Scanner stopped.";
        isRunning = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    }

    startBtn.addEventListener("click", startScanner);
    stopBtn.addEventListener("click", stopScanner);
  </script>
</body>
</html>
